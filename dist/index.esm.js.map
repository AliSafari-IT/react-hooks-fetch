{"version":3,"file":"index.esm.js","sources":["../src/ErrorBoundary.ts","../src/useFetch.ts"],"sourcesContent":["import { Component, ReactNode } from 'react';\n\ntype Fallback = ReactNode | ((error?: Error, retry?: () => void) => ReactNode);\n\ntype Props = {\n  fallback: Fallback;\n};\n\ntype State = {\n  error: Error | null;\n};\n\n/**\n * ErrorBoundary with retry support\n *\n * @example\n * import { ErrorBoundary } from 'react-hooks-fetch';\n *\n * const App = () => (\n *   <ErrorBoundary\n *     fallback={({ error, retry }) => (\n *       <div>\n *         <span>{error.message}</span>\n *         <button type=\"button\" onClick={retry}>Retry</button>\n *       </div>\n *     )}\n *   >\n *     ...\n *   </ErrorBoundary>\n * };\n */\nexport class ErrorBoundary extends Component<Props, State> {\n  state = { error: null } as State;\n\n  static getDerivedStateFromError(error: Error) {\n    return { error };\n  }\n\n  retry = () => { this.setState({ error: null }); };\n\n  render() {\n    const { error } = this.state;\n    const { children, fallback } = this.props;\n    if (error) {\n      if (typeof fallback === 'function') {\n        return fallback(error, this.retry);\n      }\n      return fallback;\n    }\n    return children;\n  }\n}\n","import {\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\nimport {\n  prefetch,\n  refetch as refetchSuspendable,\n  Suspendable,\n} from 'react-suspense-fetch';\n\n/**\n * useFetch hook for React Suspense\n *\n * @example\n * import { prefetch, useFetch } from 'react-hooks-fetch';\n *\n * const fetchFunc = async (userId) => {\n *   const res = await fetch(`https://reqres.in/api/users/${userId}?delay=3`);\n *   return res.json();\n * };\n *\n * const suspendable = prefetch(fetchFunc, '1');\n *\n * const Component = () => {\n *   const { result, refetch } = useFetch(suspendable);\n *   // ...\n * };\n */\nexport const useFetch = <Result extends object, Input>(\n  suspendable: Suspendable<Result, Input>,\n) => {\n  if (suspendable !== useRef(suspendable).current) {\n    throw new Error('suspendable has to be prefetched outside render');\n  }\n  const [result, setResult] = useState<Result>(suspendable);\n  const refetch = useCallback((input: Input) => {\n    setResult(refetchSuspendable(suspendable, input));\n  }, [suspendable]);\n  return { result, refetch };\n};\n\n\ntype FetchFunc<Result, Input> = (input: Input) => Promise<Result>;\n\n/**\n * useFetch hook for React Suspense without prefetch\n *\n * @example\n * import { useFetchWithoutPrefetch } from 'react-hooks-fetch';\n *\n * const fetchFunc = async (userId) => {\n *   const res = await fetch(`https://reqres.in/api/users/${userId}?delay=3`);\n *   return res.json();\n * };\n *\n * const Component = ({ initialInput }) => {\n *   const { result, refetch } = useFetchWithoutPrefetch(fetchFunc, initialInput);\n *   // ...\n * };\n */\nexport const useFetchWithoutPrefetch = <Result extends object, Input>(\n  fetchFunc: FetchFunc<Result, Input>,\n  initialInput?: Input,\n) => {\n  if (fetchFunc !== useRef(fetchFunc).current) {\n    throw new Error('fetchFunc has to be defined outside render');\n  }\n  const [result, setResult] = useState<Result | null>(null);\n  useEffect(() => {\n    if (initialInput !== undefined) {\n      setResult(prefetch(fetchFunc, initialInput));\n    }\n  }, [fetchFunc, initialInput]);\n  const refetch = useCallback((input: Input) => {\n    setResult(prefetch(fetchFunc, input));\n  }, [fetchFunc]);\n  return { result, refetch };\n};\n"],"names":["ErrorBoundary","error","_this","setState","getDerivedStateFromError","render","this","state","props","children","fallback","retry","Component","useFetch","suspendable","useRef","current","Error","useState","setResult","result","refetch","useCallback","input","refetchSuspendable","useFetchWithoutPrefetch","fetchFunc","initialInput","useEffect","undefined","prefetch"],"mappings":"oMA+BaA,IAAAA,sBAAb,iEACU,CAAEC,MAAO,MAMjBC,QAAQ,WAAQA,EAAKC,SAAS,CAAEF,MAAO,wGAPzCD,EAGSI,yBAAP,SAAgCH,GAC9B,MAAO,CAAEA,MAAAA,gBAKXI,OAAA,eACUJ,EAAUK,KAAKC,MAAfN,QACuBK,KAAKE,MAA5BC,IAAAA,SAAUC,IAAAA,SAClB,OAAIT,EACsB,mBAAbS,EACFA,EAAST,EAAOK,KAAKK,OAEvBD,EAEFD,MAlBwBG,GCDtBC,EAAW,SACtBC,GAEA,GAAIA,IAAgBC,EAAOD,GAAaE,QACtC,UAAUC,MAAM,yDAEUC,EAAiBJ,GAA9BK,OAIf,MAAO,CAAEC,YAAQC,QAHDC,EAAY,SAACC,GAC3BJ,EAAUK,EAAmBV,EAAaS,KACzC,CAACT,MAuBOW,EAA0B,SACrCC,EACAC,GAEA,GAAID,IAAcX,EAAOW,GAAWV,QAClC,UAAUC,MAAM,oDAEUC,EAAwB,MAA7CE,OAAQD,OASf,OARAS,EAAU,gBACaC,IAAjBF,GACFR,EAAUW,EAASJ,EAAWC,KAE/B,CAACD,EAAWC,IAIR,CAAEP,OAAAA,EAAQC,QAHDC,EAAY,SAACC,GAC3BJ,EAAUW,EAASJ,EAAWH,KAC7B,CAACG"}