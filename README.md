# react-hooks-fetch

[![Build Status](https://travis-ci.com/dai-shi/react-hooks-fetch.svg?branch=master)](https://travis-ci.com/dai-shi/react-hooks-fetch)
[![npm version](https://badge.fury.io/js/react-hooks-fetch.svg)](https://badge.fury.io/js/react-hooks-fetch)
[![bundle size](https://badgen.net/bundlephobia/minzip/react-hooks-fetch)](https://bundlephobia.com/result?p=react-hooks-fetch)

React custom hooks for data fetching with Suspense

## Important notes

If you are looking for useEffect-based React hooks for Fetch API,
please visit <https://github.com/dai-shi/react-hooks-async>.

This is a library for async functions with Suspense

## Introduction

[Suspense for data fetching](https://reactjs.org/docs/concurrent-mode-suspense.html) is a new feature coming in React.
This library provides `useFetch` hook for Render-as-You-Fetch.
It discourages Fetch-on-Render pattern.

## Install

```bash
npm install react-hooks-fetch
```

## Usage

```javascript
import React, { Suspense, useTransition } from 'react';
import ReactDOM from 'react-dom';

import { ErrorBoundary, createFetchStore, useFetch } from 'react-hooks-fetch';

const DisplayData = ({ result, refetch }) => {
  const [startTransition, isPending] = useTransition({
    timeoutMs: 1000,
  });
  const onClick = () => {
    startTransition(() => {
      refetch('2');
    });
  };
  return (
    <div>
      <div>First Name: {result.data.first_name}</div>
      <button type="button" onClick={onClick}>Refetch user 2</button>
      {isPending && 'Pending...'}
    </div>
  );
};

const fetchFunc = async (userId) => (await fetch(`https://reqres.in/api/users/${userId}?delay=3`)).json();
const store = createFetchStore(fetchFunc);
store.prefetch('1');

const Main = () => {
  const [result, refetch] = useFetch(store, '1');
  return <DisplayData result={result} refetch={refetch} />;
};

const App = () => (
  <ErrorBoundary fallback={error => <h1>{error.message}</h1>}>
    <Suspense fallback={<span>Loading...</span>}>
      <Main />
    </Suspense>
  </ErrorBoundary>
);

ReactDOM.createRoot(document.getElementById('app')).render(<App />);
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### createFetchStore

create fetch store

#### Parameters

-   `fetchFunc` **FetchFunc&lt;Result, Input>** 
-   `preloaded` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;{input: Input, result: Result}>?** 

#### Examples

```javascript
import { createFetchStore } from 'react-hooks-fetch';

const fetchFunc = async (userId) => (await fetch(`https://reqres.in/api/users/${userId}?delay=3`)).json();
const store = createFetchStore(fetchFunc);
store.prefetch('1');
```

### ErrorBoundary

**Extends Component**

ErrorBoundary with retry support

#### Examples

```javascript
import { ErrorBoundary } from 'react-hooks-fetch';

const App = () => (
  <ErrorBoundary
    fallback={({ error, retry }) => (
      <div>
        <span>{error.message}</span>
        <button type="button" onClick={retry}>Retry</button>
      </div>
    )}
  >
    ...
  </ErrorBoundary>
};
```

### useFetch

useFetch hook

#### Parameters

-   `store` **FetchStore&lt;Result, Input>** 
-   `initialInput` **Input?** 

#### Examples

```javascript
import { useFetch } from 'react-hooks-fetch';

const [result, refetch] = useFetch(store, initialInput);
```

## Examples

The [examples](examples) folder contains working examples.
You can run one of them with

```bash
PORT=8080 npm run examples:01_minimal
```

and open <http://localhost:8080> in your web browser.

You can also try them in codesandbox.io:
[01](https://codesandbox.io/s/github/dai-shi/react-hooks-fetch/tree/master/examples/01_minimal)
[02](https://codesandbox.io/s/github/dai-shi/react-hooks-fetch/tree/master/examples/02_typescript)
[03](https://codesandbox.io/s/github/dai-shi/react-hooks-fetch/tree/master/examples/03_noinit)

## Blogs

See [History](./HISTORY.md) for previous implementations.

-   [React Hooks Tutorial on Developing a Custom Hook for Data Fetching](https://blog.axlight.com/posts/react-hooks-tutorial-on-developing-a-custom-hook-for-data-fetching/)
-   [useFetch: React custom hook for Fetch API with Suspense and Concurrent Mode in Mind](https://blog.axlight.com/posts/usefetch-react-custom-hook-for-fetch-api-with-suspense-and-concurrent-mode-in-mind/)
-   [Developing a React Library for Suspense for Data Fetching in Concurrent Mode](https://blog.axlight.com/posts/developing-a-react-library-for-suspense-for-data-fetching-in-concurrent-mode/)
-   [Diving Into React Suspense Render-as-You-Fetch for REST APIs](https://blog.axlight.com/posts/diving-into-react-suspense-render-as-you-fetch-for-rest-apis/)
