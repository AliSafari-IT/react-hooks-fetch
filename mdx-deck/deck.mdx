import {
  CodeSurferLayout,
  CodeSurferColumnLayout,
} from "code-surfer";
export { githubFull as theme } from "code-surfer";

# How to develop React useFetch hook

---

<CodeSurferLayout>

```js title="Step1: minimal"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    const fetchData = async () => {
      const response = await fetch(url);
      const data = await response.json();
      setResult({ data });
    };
    fetchData();
  }, [url]);
  return result;
};
```

</CodeSurferLayout>

---

<CodeSurferLayout>

```js subtitle="Create a hook"
const useFetch = url => {

};
```

```js subtitle="Create a state"
const useFetch = url => {
  const [result, setResult] = useState({});

  return result;
};
```

```js subtitle="Add an effect"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {

  }, [url]);
  return result;
};
```

```js subtitle="Define an async func"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    const fetchData = async () => {

    };
  }, [url]);
  return result;
};
```

```js subtitle="Invoke the async func"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    const fetchData = async () => {

    };
    fetchData();
  }, [url]);
  return result;
};
```

```js subtitle="Implement the async func"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    const fetchData = async () => {
      const response = await fetch(url);
      const data = await response.json();
      setResult({ data });
    };
    fetchData();
  }, [url]);
  return result;
};
```

```js 5:6 subtitle="Fetch data"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    const fetchData = async () => {
      const response = await fetch(url);
      const data = await response.json();
      setResult({ data });
    };
    fetchData();
  }, [url]);
  return result;
};
```

```js 7 subtitle="Set state"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    const fetchData = async () => {
      const response = await fetch(url);
      const data = await response.json();
      setResult({ data });
    };
    fetchData();
  }, [url]);
  return result;
};
```

```js 10 subtitle="Follow exhaustive-deps rule"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    const fetchData = async () => {
      const response = await fetch(url);
      const data = await response.json();
      setResult({ data });
    };
    fetchData();
  }, [url]);
  return result;
};
```

</CodeSurferLayout>

---

<CodeSurferLayout>


```js title="Step2: didCleanup flag"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const fetchData = async () => {
      const response = await fetch(url);
      const data = await response.json();
      if (!didCleanup) {
        setResult({ data });
      }
    };
    fetchData();
    const cleanup = () => {
      didCleanup = true;
    };
    return cleanup;
  }, [url]);
  return result;
};
```

</CodeSurferLayout>

---

<CodeSurferLayout>


```js subtitle="From step1"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    const fetchData = async () => {
      const response = await fetch(url);
      const data = await response.json();
      setResult({ data });
    };
    fetchData();
  }, [url]);
  return result;
};
```

```js subtitle="Define a didCleanup flag"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const fetchData = async () => {
      const response = await fetch(url);
      const data = await response.json();
      setResult({ data });
    };
    fetchData();
  }, [url]);
  return result;
};
```

```js subtitle="Define a cleanup func"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const fetchData = async () => {
      const response = await fetch(url);
      const data = await response.json();
      setResult({ data });
    };
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

```js 12 subtitle="Set the didCleanup flag"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const fetchData = async () => {
      const response = await fetch(url);
      const data = await response.json();
      setResult({ data });
    };
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

```js 13 subtitle="Clear state"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const fetchData = async () => {
      const response = await fetch(url);
      const data = await response.json();
      setResult({ data });
    };
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

```js 15 subtitle="Return the cleanup func"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const fetchData = async () => {
      const response = await fetch(url);
      const data = await response.json();
      setResult({ data });
    };
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

```js subtitle="Only set state if not didCleanup"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const fetchData = async () => {
      const response = await fetch(url);
      const data = await response.json();
      if (!didCleanup) {
        setResult({ data });
      }
    };
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

</CodeSurferLayout>

---

<CodeSurferLayout>


```js title="Step3: loading flag"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const fetchData = async () => {
      const response = await fetch(url);
      const data = await response.json();
      if (!didCleanup) {
        setResult({ data });
      }
    };
    setResult({ loading: true });
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

</CodeSurferLayout>

---

<CodeSurferLayout>

```js subtitle="From step2"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const fetchData = async () => {
      const response = await fetch(url);
      const data = await response.json();
      if (!didCleanup) {
        setResult({ data });
      }
    };
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

```js subtitle="Set loading flag before fetching"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const fetchData = async () => {
      const response = await fetch(url);
      const data = await response.json();
      if (!didCleanup) {
        setResult({ data });
      }
    };
    setResult({ loading: true });
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

</CodeSurferLayout>

---

<CodeSurferLayout>


```js title="Step4: error handling"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const fetchData = async () => {
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error('status: ' + response.status);
        }
        const data = await response.json();
        if (!didCleanup) {
          setResult({ data });
        }
      } catch (error) {
        if (!didCleanup) {
          setResult({ error });
        }
      }
    };
    setResult({ loading: true });
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

</CodeSurferLayout>

---

<CodeSurferLayout>

```js subtitle="From step3"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const fetchData = async () => {
      const response = await fetch(url);
      const data = await response.json();
      if (!didCleanup) {
        setResult({ data });
      }
    };
    setResult({ loading: true });
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

```js subtitle="Add try-catch"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const fetchData = async () => {
      try {
        const response = await fetch(url);
        const data = await response.json();
        if (!didCleanup) {
          setResult({ data });
        }
      } catch (error) {

      }
    };
    setResult({ loading: true });
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

```js subtitle="Set error in catch"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const fetchData = async () => {
      try {
        const response = await fetch(url);
        const data = await response.json();
        if (!didCleanup) {
          setResult({ data });
        }
      } catch (error) {
        if (!didCleanup) {
          setResult({ error });
        }
      }
    };
    setResult({ loading: true });
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

```js subtitle="Throw error if response is not ok"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const fetchData = async () => {
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error('status: ' + response.status);
        }
        const data = await response.json();
        if (!didCleanup) {
          setResult({ data });
        }
      } catch (error) {
        if (!didCleanup) {
          setResult({ error });
        }
      }
    };
    setResult({ loading: true });
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

</CodeSurferLayout>

---

<CodeSurferLayout>


```js title="Step5: cancel handling"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const abortController = new AbortController();
    const fetchData = async () => {
      try {
        const response = await fetch(url, {
          signal: abortController.signal
        });
        if (!response.ok) {
          throw new Error('status: ' + response.status);
        }
        const data = await response.json();
        if (!didCleanup) {
          setResult({ data });
        }
      } catch (error) {
        if (!didCleanup) {
          setResult({ error });
        }
      }
    };
    setResult({ loading: true });
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      abortController.abort();
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

</CodeSurferLayout>

---

<CodeSurferLayout>

```js subtitle="From step4"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const fetchData = async () => {
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error('status: ' + response.status);
        }
        const data = await response.json();
        if (!didCleanup) {
          setResult({ data });
        }
      } catch (error) {
        if (!didCleanup) {
          setResult({ error });
        }
      }
    };
    setResult({ loading: true });
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

```js subtitle="Create an AbortController"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const abortController = new AbortController();
    const fetchData = async () => {
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error('status: ' + response.status);
        }
        const data = await response.json();
        if (!didCleanup) {
          setResult({ data });
        }
      } catch (error) {
        if (!didCleanup) {
          setResult({ error });
        }
      }
    };
    setResult({ loading: true });
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

```js subtitle="Set signal in fetch"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const abortController = new AbortController();
    const fetchData = async () => {
      try {
        const response = await fetch(url, {
          signal: abortController.signal
        });
        if (!response.ok) {
          throw new Error('status: ' + response.status);
        }
        const data = await response.json();
        if (!didCleanup) {
          setResult({ data });
        }
      } catch (error) {
        if (!didCleanup) {
          setResult({ error });
        }
      }
    };
    setResult({ loading: true });
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

```js subtitle="Call abort on cleanup"
const useFetch = url => {
  const [result, setResult] = useState({});
  useEffect(() => {
    let didCleanup = false;
    const abortController = new AbortController();
    const fetchData = async () => {
      try {
        const response = await fetch(url, {
          signal: abortController.signal
        });
        if (!response.ok) {
          throw new Error('status: ' + response.status);
        }
        const data = await response.json();
        if (!didCleanup) {
          setResult({ data });
        }
      } catch (error) {
        if (!didCleanup) {
          setResult({ error });
        }
      }
    };
    setResult({ loading: true });
    fetchData();
    const cleanup = () => {
      didCleanup = true;
      abortController.abort();
      setResult({});
    };
    return cleanup;
  }, [url]);
  return result;
};
```

</CodeSurferLayout>

---

## TODO: fetch options

---

# The end
